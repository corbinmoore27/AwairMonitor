<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <!-- CSS -->
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Roboto:400,100,300,500">
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="assets/css/form-elements.css">
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="form-3/assets/css/form-elements.css">
    <title>Graphs</title>
</head>
<br><br>
<!-- Navigation -->
<nav class="navbar navbar-expand-lg">
        <a class="navbar-brand" href="../public/form-3/index.html">AIRU</a>
        <button type="button" class="btn btn-default navbar-btn" href="../public/form-3/index.html">Login</button>
        <button type="button" class="btn btn-default navbar-btn" href="../public/form-3/product_info.html">What is AWAIR</button>
        
        <img src="./form-3/images/airu.jpg" alt="air u sensor" class="pull-right airU">
      </nav>

<body>
    <h1>Average Air Quality in Your Home Yesterday</h1>
    <canvas id="myChart" width="800" height="800"></canvas>

    <h1>Average Air Quality in Your Home Last Week</h1>
    <canvas id="myChart2" width="800" height="800"></canvas>

    <h1>Average Air Quality in Your Home Last Month</h1>
    <canvas id="myChart3" width="800" height="800"></canvas>


</body>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.min.js"></script>
<script>


    // father forgive me for i have sinned
    var badGlobalArrayYesterday = [];
    var badGlobalArrayLastWeek = [];
    var badGlobalArrayLastMonth = [];





    $.ajax({
        url: "http://localhost:7000/api/Reading",
        method: "GET"
    }).then(function (response) {

        //====================================================================
        //average for yesterday's values
        //====================================================================
        var avgYesterdayPM1 = averageYesterday(response, "PM1");
        var avgYesterdayPM25 = averageYesterday(response, "PM25");
        var avgYesterdayPM10 = averageYesterday(response, "PM10");
        var avgYesterdayTemp = averageYesterday(response, "Temp");
        var avgYesterdayHum = averageYesterday(response, "Hum");
        //removed CO because it was throwing off scale
        // var cavgYesterdayCO = averageYesterday(response, "CO");
        var avgYesterdayNO = averageYesterday(response, "NO");

        //function to create graph for yesterday's data
        averageYesterdayGraph(avgYesterdayPM1, avgYesterdayPM25, avgYesterdayPM10, avgYesterdayTemp, avgYesterdayHum, avgYesterdayNO);



        //====================================================================
        //average for last week's values
        //====================================================================
        var avgLastWeekPM1 = averageLastWeek(response, "PM1");
        var avgLastWeekPM25 = averageLastWeek(response, "PM25");
        var avgLastWeek10 = averageLastWeek(response, "PM10");
        var avgLastWeekTemp = averageLastWeek(response, "Temp");
        var avgLastWeekHum = averageLastWeek(response, "Hum");
        //removed CO because it was throwing off scale
        // var avgLastWeekCO = averageLastWeek(response, "CO");
        var avgLastWeekNO = averageLastWeek(response, "NO");

        //function to create graph for last week's data
        averageLastWeekGraph(avgLastWeekPM1, avgLastWeekPM25, avgLastWeek10, avgLastWeekTemp, avgLastWeekHum, avgLastWeekNO)




        //====================================================================
        //average for last month's values
        //====================================================================
        var avgLastMonthPM1 = averageLastMonth(response, "PM1");
        var avgLastMonthPM25 = averageLastMonth(response, "PM25");
        var avgLastMonthPM10 = averageLastMonth(response, "PM10");
        var avgLastMonthTemp = averageLastMonth(response, "Temp");
        var avgLastMonthHum = averageLastMonth(response, "Hum");
        //removed CO because it was throwing off scale
        // var avgLastMonthCO = averageLastMonth(response, "CO");
        var avgLastMonthNO = averageLastMonth(response, "NO");

        //function to create graph for last month's data
        averageLastMonthGraph(avgLastMonthPM1, avgLastMonthPM25, avgLastMonthPM10, avgLastMonthTemp, avgLastMonthHum, avgLastMonthNO);
    });



    //Function that will get the averages for the 7 tracked values from yesterday
    function averageYesterday(response, value) {

        // today's date
        let yesterday = new Date('2018-05-11');

        let N = 0; // how many days to average over
        let avgYesterdayValue = 0;
        console.log(response);
        for (let i = 0; i < response.length; i++) {
            // create date object for this reponse
            var date = new Date(response[i].Date);

            // if this response has data from yesterday, then sum
            if (date.getTime() === yesterday.getTime()) {
                avgYesterdayValue += response[i][value];
                N += 1;
            }
        }
        badGlobalArrayYesterday.push(avgYesterdayValue / N);
        return avgYesterdayValue / N;
    }


    //Function that will get the averages for the 7 tracked values for the past week
    function averageLastWeek(response, value) {

        // starting and ending dates for week range
        let lastWeekStartDate = new Date('2018-05-04');
        let lastWeekEndDate = new Date('2018-05-11');

        let N = 0; // how many days to average over
        let avgLastWeekValue = 0;
        for (let i = 0; i < response.length; i++) {
            // create date object for this reponse
            var date = new Date(response[i].Date);

            // if this response has data from yesterday, then sum
            if (date.getTime() >= lastWeekStartDate.getTime() || date.getTime() <= lastWeekEndDate) {
                avgLastWeekValue += response[i][value];
                N += 1;
            }
        }
        badGlobalArrayLastWeek.push(avgLastWeekValue / N);
        return avgLastWeekValue / N;
    }


    //Function that will get the averages for the 7 tracked values for the past week
    function averageLastMonth(response, value) {

        // starting and ending dates for week range
        let lastMonthStartDate = new Date('2018-04-11');
        let lastMonthEndDate = new Date('2018-05-11');

        let N = 0; // how many days to average over
        let avgLastMonthvalue = 0;
        for (let i = 0; i < response.length; i++) {
            // create date object for this reponse
            var date = new Date(response[i].Date);

            // if this response has data from yesterday, then sum
            if (date.getTime() >= lastMonthStartDate.getTime() || date.getTime() <= lastMonthEndDate) {
                avgLastMonthvalue += response[i][value];
                N += 1;
            }
        }
        badGlobalArrayLastMonth.push(avgLastMonthvalue / N);
        return avgLastMonthvalue / N;
    }





    //function for rendering average yesterday graph
    function averageYesterdayGraph(avgYesterdayPM1, avgYesterdayPM25, avgYesterdayPM10, avgYesterdayTemp, avgYesterdayHum, avgYesterdayNO) {
        var canvas = document.getElementById("myChart");
        var myChart = new Chart(canvas, {
            type: 'bar',
            data: {
                labels: ["PM 1", "PM 2.5", "PM 10", "Temperature", "Humidity", "Nitric Oxide"],
                datasets: [{
                    label: 'Average Air Quality for Yesterday in Your Home',
                    data: badGlobalArrayYesterday,
                    backgroundColor: [
                        //PM1
                        'rgba(0, 0, 255, 0.2)',
                        //PM2.5
                        'rgba(1, 1, 1, 0.2)',
                        //PM10
                        'rgba(63, 29, 11, 0.2)',
                        //Temp
                        'rgba(120, 12, 0, 0.2)',
                        //Hum
                        'rgba(18, 53, 162, 0.2)',
                        //CO
                        // 'rgba(67, 63, 64, 0.2)',
                        //NO
                        'rgba(70, 0, 0, 0.2)'
                    ],
                    hoverBackgroundColor: [
                        //PM1
                        'rgba(0, 0, 255, 0.5)',
                        //PM2.5
                        'rgba(1, 1, 1, 0.5)',
                        //PM10
                        'rgba(63, 29, 11, 0.5)',
                        //Temp
                        'rgba(120, 12, 0, 0.5)',
                        //Hum
                        'rgba(18, 53, 162, 0.5)',
                        //CO
                        // 'rgba(67, 63, 64, 0.5)',
                        //NO
                        'rgba(70, 0, 0, 0.5)'
                    ],
                    borderColor: [
                        //PM1
                        'rgba(0, 0, 255, 1)',
                        //PM2.5
                        'rgba(1, 1, 1, 1)',
                        //PM10
                        'rgba(63, 29, 11, 1)',
                        //Temp
                        'rgba(120, 12, 0, 1)',
                        //Hum
                        'rgba(18, 53, 162, 1)',
                        //CO
                        // 'rgba(67, 63, 64, 1)',
                        //NO
                        'rgba(70, 0, 0, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                tooltips: {
                    callbacks: {
                        title: function (tooltipItem, data) {
                            return data['labels'][tooltipItem[0]['index']];
                        },
                        label: function (tooltipItem, data) {
                            return data['datasets'][0]['data'][tooltipItem['index']];
                        }
                    }
                },
                legend: {
                    display: false
                },
                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero: true
                        }
                    }]
                },
                responsive: false
            }
        });

    }

    function averageLastWeekGraph(avgLastWeekPM1, avgLastWeekPM25, avgLastWeek10, avgLastWeekTemp, avgLastWeekHum, avgLastWeekNO) {
        var canvas = document.getElementById("myChart2");
        var myChart = new Chart(canvas, {
            type: 'bar',
            data: {
                labels: ["PM 1", "PM 2.5", "PM 10", "Temperature", "Humidity", "Nitric Oxide"],
                datasets: [{
                    label: 'Average Air Quality for Last Week in Your Home',
                    data: badGlobalArrayLastWeek,
                    backgroundColor: [
                        //PM1
                        'rgba(0, 0, 255, 0.2)',
                        //PM2.5
                        'rgba(1, 1, 1, 0.2)',
                        //PM10
                        'rgba(63, 29, 11, 0.2)',
                        //Temp
                        'rgba(120, 12, 0, 0.2)',
                        //Hum
                        'rgba(18, 53, 162, 0.2)',
                        //CO
                        // 'rgba(67, 63, 64, 0.2)',
                        //NO
                        'rgba(70, 0, 0, 0.2)'
                    ],
                    hoverBackgroundColor: [
                        //PM1
                        'rgba(0, 0, 255, 0.5)',
                        //PM2.5
                        'rgba(1, 1, 1, 0.5)',
                        //PM10
                        'rgba(63, 29, 11, 0.5)',
                        //Temp
                        'rgba(120, 12, 0, 0.5)',
                        //Hum
                        'rgba(18, 53, 162, 0.5)',
                        //CO
                        // 'rgba(67, 63, 64, 0.5)',
                        //NO
                        'rgba(70, 0, 0, 0.5)'
                    ],
                    borderColor: [
                        //PM1
                        'rgba(0, 0, 255, 1)',
                        //PM2.5
                        'rgba(1, 1, 1, 1)',
                        //PM10
                        'rgba(63, 29, 11, 1)',
                        //Temp
                        'rgba(120, 12, 0, 1)',
                        //Hum
                        'rgba(18, 53, 162, 1)',
                        //CO
                        // 'rgba(67, 63, 64, 1)',
                        //NO
                        'rgba(70, 0, 0, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                tooltips: {
                    callbacks: {
                        title: function (tooltipItem, data) {
                            return data['labels'][tooltipItem[0]['index']];
                        },
                        label: function (tooltipItem, data) {
                            return data['datasets'][0]['data'][tooltipItem['index']];
                        }
                    }
                },
                legend: {
                    display: false
                },
                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero: true
                        }
                    }]
                },
                responsive: false
            }
        });

    }


    function averageLastMonthGraph(avgLastMonthPM1, avgLastMonthPM25, avgLastMonthPM10, avgLastMonthTemp, avgLastMonthHum, avgLastMonthNO) {
        var canvas = document.getElementById("myChart3");
        var myChart = new Chart(canvas, {
            type: 'bar',
            data: {
                labels: ["PM 1", "PM 2.5", "PM 10", "Temperature", "Humidity", "Nitric Oxide"],
                datasets: [{
                    label: 'Average Air Quality for Last Month in Your Home',
                    data: badGlobalArrayLastMonth,
                    backgroundColor: [
                        //PM1
                        'rgba(0, 0, 255, 0.2)',
                        //PM2.5
                        'rgba(1, 1, 1, 0.2)',
                        //PM10
                        'rgba(63, 29, 11, 0.2)',
                        //Temp
                        'rgba(120, 12, 0, 0.2)',
                        //Hum
                        'rgba(18, 53, 162, 0.2)',
                        //CO
                        // 'rgba(67, 63, 64, 0.2)',
                        //NO
                        'rgba(70, 0, 0, 0.2)'
                    ],
                    hoverBackgroundColor: [
                        //PM1
                        'rgba(0, 0, 255, 0.5)',
                        //PM2.5
                        'rgba(1, 1, 1, 0.5)',
                        //PM10
                        'rgba(63, 29, 11, 0.5)',
                        //Temp
                        'rgba(120, 12, 0, 0.5)',
                        //Hum
                        'rgba(18, 53, 162, 0.5)',
                        //CO
                        // 'rgba(67, 63, 64, 0.5)',
                        //NO
                        'rgba(70, 0, 0, 0.5)'
                    ],
                    borderColor: [
                        //PM1
                        'rgba(0, 0, 255, 1)',
                        //PM2.5
                        'rgba(1, 1, 1, 1)',
                        //PM10
                        'rgba(63, 29, 11, 1)',
                        //Temp
                        'rgba(120, 12, 0, 1)',
                        //Hum
                        'rgba(18, 53, 162, 1)',
                        //CO
                        // 'rgba(67, 63, 64, 1)',
                        //NO
                        'rgba(70, 0, 0, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                tooltips: {
                    callbacks: {
                        title: function (tooltipItem, data) {
                            return data['labels'][tooltipItem[0]['index']];
                        },
                        label: function (tooltipItem, data) {
                            return data['datasets'][0]['data'][tooltipItem['index']];
                        }
                    }
                },
                legend: {
                    display: false
                },
                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero: true
                        }
                    }]
                },
                responsive: false
            }
        });

    }
        // //Function to round numbers to 3 decimal places. It requires 2 variables, the number (number) and how many decimal places you wish to round to (precision)
    // function round(number, precision) {
    //     var shift = function (number, precision) {
    //         var numArray = ("" + number).split("e");
    //         return +(numArray[0] + "e" + (numArray[1] ? (+numArray[1] + precision) : precision));
    //     };
    //     return shift(Math.round(shift(number, +precision)), -precision);
    // }

</script>

</html>